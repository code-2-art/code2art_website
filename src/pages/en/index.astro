---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { t, getLocalePath } from '../../i18n/ui';
import type { Lang } from '../../i18n/ui';

const lang: Lang = 'en';

const allPosts = await getCollection('tutorials', ({ filePath }) => filePath.includes('/en/'));
allPosts.sort((a, b) => new Date(b.data.publishedAt ?? 0).getTime() - new Date(a.data.publishedAt ?? 0).getTime());
const blogPosts = allPosts.slice(0, 6);

const allActivities = await getCollection('events', ({ filePath }) => filePath.includes('/en/'));
allActivities.sort((a, b) => new Date(b.data.event_date ?? 0).getTime() - new Date(a.data.event_date ?? 0).getTime());
const activities = allActivities.slice(0, 6);
const formatEventDate = (value?: string | Date) => {
  if (!value) return '';
  const date = value instanceof Date ? value : new Date(value);
  return Number.isNaN(date.getTime()) ? '' : date.toISOString().slice(0, 10);
};
const resolveListHref = (useDocUrl: boolean | undefined, docUrl: string | undefined, fallbackPath: string) => {
  if (!useDocUrl) return fallbackPath;
  const external = docUrl?.trim();
  return external && external.length > 0 ? external : fallbackPath;
};

const otherLang = 'zh';
const switchLabel = 'ä¸­æ–‡';
const switchHref = getLocalePath(otherLang, '/');
---

<BaseLayout title="Experimental Programming" description="Experimental Programming â€” exploring the intersection of technology and art" lang={lang} altPath="">

  <!-- Hero Section -->
  <section id="home" class="pt-32 pb-20 md:pt-40 md:pb-32 overflow-hidden">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
      <div>
        <h1 class="text-[clamp(2.5rem,5vw,4rem)] font-bold leading-tight mb-6">
          {t(lang, 'hero.title.prefix')}
          <span class="bg-gradient-to-r from-primary to-secondary text-gradient">{t(lang, 'hero.title.highlight')}</span>
        </h1>
        <p class="text-lg md:text-xl text-gray-600 mb-8 max-w-xl">
          {t(lang, 'hero.description')}
          <br/>
          {t(lang, 'hero.description2')}
        </p>
        <div class="flex flex-col sm:flex-row gap-4">
          <a href="#contact" class="bg-gradient-to-r from-primary to-secondary text-white px-8 py-4 rounded-full font-medium text-center hover:shadow-lg hover:shadow-primary/20 transition-all transform hover:-translate-y-1">{t(lang, 'hero.joinCta')}</a>
          <a href="https://mp.weixin.qq.com/s/3z-tmlSkV0mlTrWAPXgoUw" class="border-2 border-primary text-primary px-8 py-4 rounded-full font-medium text-center hover:bg-primary/5 transition-all transform hover:-translate-y-1">{t(lang, 'hero.learnMore')}</a>
        </div>
      </div>
      <div class="relative">
        <div class="absolute inset-0 bg-gradient-to-r from-primary/20 to-secondary/20 rounded-3xl transform rotate-3 scale-95"
        style="background-image: url('https://float.intplusplus.cn/code2art/assets/fluid2.jpg'); background-size: cover; background-position: center;"
        >
        </div>

        <img src="https://float.intplusplus.cn/code2art/assets/fluid.jpg" width="600" height="600" alt={t(lang, 'hero.imgAlt') as string} class="relative z-10 rounded-3xl shadow-xl animate-float" />
      </div>
    </div>
  </section>

  <!-- Activities Section -->
  <section id="events" class="py-20 md:py-32">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center max-w-3xl mx-auto mb-16">
        <span class="text-primary font-semibold">{t(lang, 'activities.label')}</span>
        <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mt-2 mb-6">{t(lang, 'activities.heading')}</h2>
        <p class="text-gray-600 text-lg">{t(lang, 'activities.subheading')}</p>
      </div>

      {activities.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {activities.map((a) => (
            <div class="rounded-2xl overflow-hidden shadow-lg group hover:shadow-xl transition-all duration-300">
              <div class="relative">
                {a.data.coverUrl ? (
                  <a href={resolveListHref(a.data.useDocUrl, a.data.docUrl, getLocalePath(lang, `/events/${a.data.slug}`))} {...(a.data.useDocUrl && a.data.docUrl ? { target: '_blank', rel: 'noopener noreferrer' } : {})}>
                    <img src={a.data.coverUrl} alt={a.data.title} class="w-full h-60 object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy" />
                  </a>
                ) : (
                  <div class="w-full h-60 bg-gradient-to-br from-primary/10 to-secondary/10" />
                )}
                <div class="absolute top-4 left-4 bg-primary text-white px-3 py-1 rounded-full text-sm font-medium">{t(lang, 'activities.badge')}</div>
              </div>
              <div class="p-6">
                <div class="flex items-center text-gray-500 mb-3">ðŸ“…<span class="ml-2">{formatEventDate(a.data.event_date)}</span></div>
                <h3 class="text-xl font-bold mb-3 group-hover:text-primary transition-colors">
                  <a href={resolveListHref(a.data.useDocUrl, a.data.docUrl, getLocalePath(lang, `/events/${a.data.slug}`))} {...(a.data.useDocUrl && a.data.docUrl ? { target: '_blank', rel: 'noopener noreferrer' } : {})}>{a.data.title}</a>
                </h3>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div class="text-center text-slate-500">{t(lang, 'activities.empty')}</div>
      )}
    </div>
  </section>

  <!-- Blog Section -->
  <section id="tutorials" class="py-20 md:py-32 bg-gray-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center max-w-3xl mx-auto mb-16">
        <span class="text-primary font-semibold">{t(lang, 'blog.label')}</span>
        <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mt-2 mb-6">{t(lang, 'blog.heading')}</h2>
        <p class="text-gray-600 text-lg">{t(lang, 'blog.subheading')}</p>
      </div>

      {blogPosts.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {blogPosts.map((post) => (
            <article class="bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 group">
              <div class="relative">
                {post.data.coverUrl ? (
                  <a href={resolveListHref(post.data.useDocUrl, post.data.docUrl, getLocalePath(lang, `/tutorials/${post.data.slug}`))} {...(post.data.useDocUrl && post.data.docUrl ? { target: '_blank', rel: 'noopener noreferrer' } : {})}>
                    <img src={post.data.coverUrl} alt={post.data.title} class="w-full h-60 object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy" />
                  </a>
                ) : (
                  <div class="w-full h-60 bg-gradient-to-br from-primary/10 to-secondary/10" />
                )}
              </div>
              <div class="p-6">
                <div class="flex items-center mb-4">
                  <div class="flex flex-wrap gap-2">
                    {(post.data.tags ?? []).slice(0,4).map((tg) => (
                      <span class="bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full">{tg}</span>
                    ))}
                  </div>
                  <span class="ml-auto text-gray-500 text-sm">{post.data.publishedAt?.slice(0,10)}</span>
                </div>
                <h3 class="text-xl font-bold mb-3 hover:text-primary transition-colors">
                  <a href={resolveListHref(post.data.useDocUrl, post.data.docUrl, getLocalePath(lang, `/tutorials/${post.data.slug}`))} {...(post.data.useDocUrl && post.data.docUrl ? { target: '_blank', rel: 'noopener noreferrer' } : {})}>{post.data.title}</a>
                </h3>
                {post.data.summary && <p class="text-gray-600 mb-4 line-clamp-3">{post.data.summary}</p>}
              </div>
            </article>
          ))}
        </div>
      ) : (
        <div class="text-center text-slate-500">{t(lang, 'blog.empty')}</div>
      )}

      <div class="text-center mt-12">
        <a href={getLocalePath(lang, '/tutorials/')} class="inline-block bg-gradient-to-r from-primary to-secondary text-white px-8 py-3 rounded-full font-medium hover:shadow-lg hover:shadow-primary/20 transition-all">{t(lang, 'blog.viewMore')}</a>
      </div>
    </div>
  </section>

  <!-- Contact / Footer -->
  <section id="contact" class="py-20 md:py-32">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2">
          <div class="p-10">
            <h3 class="text-2xl font-bold mb-6">{t(lang, 'contact.heading')}</h3>
            <p class="text-gray-600 mb-6">{t(lang, 'contact.description')}</p>
            <a href="https://work.weixin.qq.com/ca/cawcde0b98ca073c6d" class="inline-flex items-center bg-gradient-to-r from-primary to-secondary text-white px-6 py-3 rounded-full font-medium">{t(lang, 'contact.cta')}</a>
          </div>
          <div class="bg-gradient-to-br from-primary/10 to-secondary/10 p-10">
            <h4 class="font-semibold mb-4">{t(lang, 'contact.infoHeading')}</h4>
            <p class="text-gray-600">{t(lang, 'contact.infoText')}</p>
          </div>
        </div>
      </div>
    </div>
  </section>


  <style>
    .text-gradient { background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .animate-float { animation: float 6s ease-in-out infinite; }
    @keyframes float { 0% { transform: translateY(0); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0); } }
  </style>
</BaseLayout>
