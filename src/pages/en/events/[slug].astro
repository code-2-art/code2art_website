---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';
import { t, getLocalePath } from '../../../i18n/ui';
import type { Lang } from '../../../i18n/ui';

const lang: Lang = 'en';

export async function getStaticPaths() {
  const events = await getCollection('events', ({ filePath }) => filePath.includes('/en/'));
  return events.map((a) => ({ params: { slug: a.data.slug }, props: { event: a } }));
}

const { event } = Astro.props;
const { Content } = await render(event);
const title = `${event.data.title} | TechArt`;
const formatEventDate = (value?: string | Date) => {
  if (!value) return '';
  const date = value instanceof Date ? value : new Date(value);
  return Number.isNaN(date.getTime()) ? '' : date.toISOString().slice(0, 10);
};
---

<BaseLayout title={title} description={event.data.summary ?? ''} ogImage={event.data.coverUrl ?? '/og-cover.jpg'} lang={lang} altPath={`events/${event.data.slug}`}>
  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
    <header class="mb-8">
      <h1 class="text-3xl md:text-4xl font-extrabold mb-4">{event.data.title}</h1>
      <div class="mt-4 flex flex-wrap items-center gap-4 text-slate-600">
        {event.data.authorAvatarUrl ? (
          <img src={event.data.authorAvatarUrl} alt={event.data.author} class="w-10 h-10 rounded-full" />
        ) : (
          <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold">
            {event.data.author?.slice(0,1) ?? 'T'}
          </div>
        )}
        <div>
          <div class="font-medium">{event.data.author ?? 'TechArt'}</div>
          {event.data.event_date && <div class="text-sm">{formatEventDate(event.data.event_date)}</div>}
        </div>
      </div>
    </header>

    {event.data.coverUrl && (
      <img src={event.data.coverUrl} alt={event.data.title} class="w-full rounded-xl shadow mb-8" />
    )}

    <div class="prose prose-lg max-w-none">
      <Content />
    </div>

    <footer class="mt-12 text-gray-500">
      <p>{t(lang, 'article.publishedAt')} {formatEventDate(event.data.event_date) || t(lang, 'article.unknownTime')}</p>
    </footer>
  </article>
</BaseLayout>
