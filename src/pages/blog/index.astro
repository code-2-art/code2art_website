---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');
posts.sort((a, b) => new Date(b.data.publishedAt ?? 0).getTime() - new Date(a.data.publishedAt ?? 0).getTime());
---

<BaseLayout title="博客 | TechArt">
  <section class="pt-28 pb-16 bg-gray-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <h1 class="text-3xl md:text-4xl font-extrabold mb-8">博客</h1>
      <div class="grid md:grid-cols-3 gap-6">
        {posts.map((post) => (
          <article class="bg-white rounded-2xl shadow-sm overflow-hidden border">
            {post.data.coverUrl && (
              <a href={post.data.docUrl || `/blog/${post.data.slug}`}>
                <img src={post.data.coverUrl} alt={post.data.title} class="w-full h-44 object-cover" />
              </a>
            )}
            <div class="p-5">
              <div class="flex items-center gap-2 mb-3">
                {(post.data.tags ?? []).slice(0,2).map((t) => (
                  <span class="bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full">{t}</span>
                ))}
                <span class="ml-auto text-slate-500 text-sm">{post.data.publishedAt?.slice(0,10)}</span>
              </div>
              <h3 class="text-lg font-bold mb-2 hover:text-primary transition-colors">
                <a href={post.data.docUrl || `/blog/${post.data.slug}`}>{post.data.title}</a>
              </h3>
              {post.data.summary && <p class="text-slate-600 line-clamp-2">{post.data.summary}</p>}
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>
